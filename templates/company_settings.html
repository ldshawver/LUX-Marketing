{% extends "base_simple.html" %}

{% block title %}Settings & Integrations - LUX Marketing{% endblock %}

{% block page_header %}
<span style="color: #00ffb4;">Settings & Integrations</span>
{% endblock %}

{% block content %}
<style>
    .settings-container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
    .tabs { display: flex; gap: 20px; margin-bottom: 30px; border-bottom: 1px solid #333; flex-wrap: wrap; }
    .tab { padding: 15px 0; cursor: pointer; border-bottom: 3px solid transparent; color: #888; transition: all 0.3s; }
    .tab:hover { color: #00ffb4; }
    .tab.active { border-bottom-color: #bc00ed; color: #bc00ed; }
    .section { display: none; }
    .section.active { display: block; }
    .form-group { margin-bottom: 25px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #00ffb4; }
    input, textarea { width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; font-family: Inter, sans-serif; }
    input:focus, textarea:focus { outline: none; border-color: #bc00ed; }
    .secrets-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
    .secret-field { background: #111; padding: 20px; border-radius: 8px; border: 1px solid #333; }
    .secret-field label { margin-bottom: 10px; }
    .secret-field input { margin-bottom: 8px; }
    .secret-status { font-size: 12px; margin-top: 5px; color: #888; }
    .secret-status.configured { color: #00ffb4; }
    button { background: #bc00ed; color: #fff; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-weight: 600; margin-top: 20px; margin-right: 10px; transition: all 0.3s; }
    button:hover { background: #9a00c0; }
    .success { color: #00ffb4; margin-top: 20px; padding: 15px; background: #001a1a; border-radius: 6px; }
    .error { color: #ff0066; margin-top: 20px; padding: 15px; background: #1a0011; border-radius: 6px; }
    .section-desc { color: #888; margin-bottom: 30px; font-size: 14px; }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .section-header { margin-bottom: 30px; }
    .section-header h2 { font-size: 24px; margin-bottom: 10px; color: #bc00ed; }
    @media (max-width: 768px) { .two-col { grid-template-columns: 1fr; } }
    
    .btn-oauth { display: inline-block; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.3s; border: none; margin: 0; background: #ff0050; color: #fff; }
    .btn-oauth:hover { background: #cc0040; }
    .btn-oauth.btn-danger { background: #dc3545; }
    .btn-oauth.btn-danger:hover { background: #bb2d3b; }
    .btn-oauth.btn-secondary { background: #444; }
    .btn-oauth.btn-secondary:hover { background: #555; }
    .tiktok-connected { color: #00ffb4; font-weight: 600; }
    .tiktok-expired { color: #ff6b6b; }
    .tiktok-avatar { width: 32px; height: 32px; border-radius: 50%; margin-right: 10px; vertical-align: middle; }
</style>

<div class="settings-container">
    <!-- Company Selector -->
    <div class="company-selector" style="background: #111; border: 1px solid #333; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
            <div style="flex: 1; min-width: 200px;">
                <label style="font-size: 12px; color: #888; display: block; margin-bottom: 5px;">Current Company</label>
                <select id="company-selector" onchange="switchCompany(this.value)" style="width: 100%; padding: 10px; background: #000; border: 1px solid #bc00ed; color: #fff; border-radius: 6px; font-size: 14px;">
                    {% for c in all_companies %}
                    <option value="{{ c.id }}" {% if c.id == company.id %}selected{% endif %}>
                        {{ c.name }}{% if c.id == default_company_id %} ‚≠ê{% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <div>
                    <label style="font-size: 12px; color: #888; display: block; margin-bottom: 5px;">Your Role</label>
                    <span style="background: {% if user_role == 'owner' %}#bc00ed{% elif user_role == 'admin' %}#00ffb4{% elif user_role == 'editor' %}#ffc107{% else %}#666{% endif %}; color: {% if user_role == 'viewer' %}#fff{% else %}#000{% endif %}; padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                        {{ user_role|title }}
                    </span>
                </div>
                <div>
                    <label style="font-size: 12px; color: #888; display: block; margin-bottom: 5px;">Default</label>
                    <button onclick="setDefaultCompany({{ company.id }})" 
                            style="padding: 6px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 12px; font-weight: 600;
                            {% if company.id == default_company_id %}
                            background: #00ffb4; color: #000;
                            {% else %}
                            background: #333; color: #888;
                            {% endif %}">
                        {% if company.id == default_company_id %}‚≠ê Default{% else %}Set as Default{% endif %}
                    </button>
                </div>
            </div>
        </div>
        {% if not can_edit %}
        <div style="margin-top: 15px; padding: 10px; background: #1a0011; border: 1px solid #ff0066; border-radius: 4px; color: #ff0066; font-size: 12px;">
            ‚ö†Ô∏è You have view-only access to this company. Contact an admin to request edit permissions.
        </div>
        {% endif %}
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('brand')">üé® Brand Settings</div>
        <div class="tab" onclick="switchTab('secrets')">üîê API Keys & Secrets</div>
        <div class="tab" onclick="switchTab('oauth')">üîó OAuth Integrations</div>
    </div>

    <!-- Brand Settings Section -->
    <div id="brand" class="section active">
        <div class="section-header">
            <h2>Brand Customization</h2>
            <p class="section-desc">Customize your brand colors and settings</p>
        </div>
        <div class="two-col">
            <div class="form-group">
                <label>Primary Color (Purple)</label>
                <input type="color" id="primary_color" value="{{ company.primary_color or '#bc00ed' }}">
            </div>
            <div class="form-group">
                <label>Secondary Color (Cyan)</label>
                <input type="color" id="secondary_color" value="{{ company.secondary_color or '#00ffb4' }}">
            </div>
            <div class="form-group">
                <label>Accent Color (Pink)</label>
                <input type="color" id="accent_color" value="{{ company.accent_color or '#e4055c' }}">
            </div>
            <div class="form-group">
                <label>Font Family</label>
                <input type="text" id="font_family" value="{{ company.font_family or 'Inter, sans-serif' }}">
            </div>
            <div class="form-group">
                <label>Website URL</label>
                <input type="text" id="website_url" value="{{ company.website_url or '' }}">
            </div>
            <div class="form-group">
                <label>Logo Path</label>
                <input type="text" id="logo_path" value="{{ company.logo_path or '' }}">
            </div>
        </div>
        <button onclick="saveBrandSettings()">üíæ Save Brand Settings</button>
        <div id="brand-message"></div>
    </div>

    <!-- API Keys & Secrets Section -->
    <div id="secrets" class="section">
        <div class="section-header">
            <h2>API Keys & Secrets</h2>
            <p class="section-desc">All secrets are encrypted and stored securely. Never share your API keys.</p>
        </div>
        <div class="secrets-grid">
            <!-- OpenAI -->
            <div class="secret-field">
                <label>ü§ñ OpenAI API Key</label>
                <input type="password" data-secret="OPENAI_API_KEY" placeholder="sk-proj-...">
                <div class="secret-status" id="status-OPENAI_API_KEY">Not configured</div>
            </div>

            <!-- Google -->
            <div class="secret-field">
                <label>üìä GA4 Property ID</label>
                <input type="text" data-secret="GA4_PROPERTY_ID" placeholder="123456789">
                <div class="secret-status" id="status-GA4_PROPERTY_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üìä GA4 Service Account JSON</label>
                <textarea data-secret="GA4_SERVICE_ACCOUNT_JSON" placeholder="{...}" rows="4"></textarea>
                <div class="secret-status" id="status-GA4_SERVICE_ACCOUNT_JSON">Not configured</div>
            </div>

            <!-- Google Ads -->
            <div class="secret-field">
                <label>üîç Google Ads Client ID</label>
                <input type="text" data-secret="GOOGLE_ADS_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-GOOGLE_ADS_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üîç Google Ads Client Secret</label>
                <input type="password" data-secret="GOOGLE_ADS_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-GOOGLE_ADS_CLIENT_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üîç Google Ads Customer ID</label>
                <input type="text" data-secret="GOOGLE_ADS_CUSTOMER_ID" placeholder="1234567890">
                <div class="secret-status" id="status-GOOGLE_ADS_CUSTOMER_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üîç Google Ads Developer Token</label>
                <input type="password" data-secret="GOOGLE_ADS_DEVELOPER_TOKEN" placeholder="developer_token...">
                <div class="secret-status" id="status-GOOGLE_ADS_DEVELOPER_TOKEN">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üîç Google Ads Refresh Token</label>
                <input type="password" data-secret="GOOGLE_ADS_REFRESH_TOKEN" placeholder="refresh_token...">
                <div class="secret-status" id="status-GOOGLE_ADS_REFRESH_TOKEN">Not configured</div>
            </div>

            <!-- Microsoft 365 -->
            <div class="secret-field">
                <label>‚òÅÔ∏è Microsoft 365 Client ID</label>
                <input type="text" data-secret="MS365_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-MS365_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>‚òÅÔ∏è Microsoft 365 Client Secret</label>
                <input type="password" data-secret="MS365_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-MS365_CLIENT_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>‚òÅÔ∏è Microsoft 365 Tenant ID</label>
                <input type="text" data-secret="MS365_TENANT_ID" placeholder="tenant_id...">
                <div class="secret-status" id="status-MS365_TENANT_ID">Not configured</div>
            </div>

            <!-- Twitter/X -->
            <div class="secret-field">
                <label>ùïè Twitter API Key</label>
                <input type="password" data-secret="TWITTER_API_KEY" placeholder="api_key...">
                <div class="secret-status" id="status-TWITTER_API_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ùïè Twitter API Secret</label>
                <input type="password" data-secret="TWITTER_API_SECRET" placeholder="api_secret...">
                <div class="secret-status" id="status-TWITTER_API_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ùïè Twitter Bearer Token</label>
                <input type="password" data-secret="TWITTER_BEARER_TOKEN" placeholder="bearer_token...">
                <div class="secret-status" id="status-TWITTER_BEARER_TOKEN">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ùïè Twitter Client ID</label>
                <input type="text" data-secret="TWITTER_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-TWITTER_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ùïè Twitter Client Secret</label>
                <input type="password" data-secret="TWITTER_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-TWITTER_CLIENT_SECRET">Not configured</div>
            </div>

            <!-- TikTok OAuth -->
            <div class="secret-field" style="border: 1px solid #ff0050;">
                <label>üéµ TikTok Client Key (Required for OAuth)</label>
                <input type="text" data-secret="TIKTOK_CLIENT_KEY" placeholder="awxxxxxxxxx">
                <div class="secret-status" id="status-TIKTOK_CLIENT_KEY">Not configured</div>
            </div>
            <div class="secret-field" style="border: 1px solid #ff0050;">
                <label>üéµ TikTok Client Secret (Required for OAuth)</label>
                <input type="password" data-secret="TIKTOK_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-TIKTOK_CLIENT_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üéµ TikTok API Key (Legacy)</label>
                <input type="password" data-secret="TIKTOK_API_KEY" placeholder="api_key...">
                <div class="secret-status" id="status-TIKTOK_API_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üéµ TikTok Access Token (Legacy)</label>
                <input type="password" data-secret="TIKTOK_ACCESS_TOKEN" placeholder="access_token...">
                <div class="secret-status" id="status-TIKTOK_ACCESS_TOKEN">Not configured</div>
            </div>

            <!-- Instagram -->
            <div class="secret-field">
                <label>üì∏ Instagram Business Account ID</label>
                <input type="text" data-secret="INSTAGRAM_BUSINESS_ACCOUNT_ID" placeholder="account_id...">
                <div class="secret-status" id="status-INSTAGRAM_BUSINESS_ACCOUNT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üì∏ Instagram Access Token</label>
                <input type="password" data-secret="INSTAGRAM_ACCESS_TOKEN" placeholder="access_token...">
                <div class="secret-status" id="status-INSTAGRAM_ACCESS_TOKEN">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üì∏ Instagram User Token</label>
                <input type="password" data-secret="INSTAGRAM_USER_TOKEN" placeholder="user_token...">
                <div class="secret-status" id="status-INSTAGRAM_USER_TOKEN">Not configured</div>
            </div>

            <!-- Facebook OAuth -->
            <div class="secret-field" style="border: 1px solid #1877f2;">
                <label>üëç Facebook App ID (Required for OAuth)</label>
                <input type="text" data-secret="facebook_app_id" placeholder="your_app_id...">
                <div class="secret-status" id="status-facebook_app_id">Not configured</div>
            </div>
            <div class="secret-field" style="border: 1px solid #1877f2;">
                <label>üëç Facebook App Secret (Required for OAuth)</label>
                <input type="password" data-secret="facebook_app_secret" placeholder="your_app_secret...">
                <div class="secret-status" id="status-facebook_app_secret">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üëç Facebook Page ID (Legacy)</label>
                <input type="text" data-secret="FACEBOOK_PAGE_ID" placeholder="page_id...">
                <div class="secret-status" id="status-FACEBOOK_PAGE_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üëç Facebook Access Token (Legacy)</label>
                <input type="password" data-secret="FACEBOOK_ACCESS_TOKEN" placeholder="access_token...">
                <div class="secret-status" id="status-FACEBOOK_ACCESS_TOKEN">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üëç Facebook App Token</label>
                <input type="password" data-secret="FACEBOOK_APP_TOKEN" placeholder="app_token...">
                <div class="secret-status" id="status-FACEBOOK_APP_TOKEN">Not configured</div>
            </div>

            <!-- Reddit -->
            <div class="secret-field">
                <label>ü§ñ Reddit Client ID</label>
                <input type="password" data-secret="REDDIT_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-REDDIT_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ü§ñ Reddit Client Secret</label>
                <input type="password" data-secret="REDDIT_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-REDDIT_CLIENT_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ü§ñ Reddit Username</label>
                <input type="text" data-secret="REDDIT_USERNAME" placeholder="username...">
                <div class="secret-status" id="status-REDDIT_USERNAME">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ü§ñ Reddit Password</label>
                <input type="password" data-secret="REDDIT_PASSWORD" placeholder="password...">
                <div class="secret-status" id="status-REDDIT_PASSWORD">Not configured</div>
            </div>

            <!-- YouTube -->
            <div class="secret-field">
                <label>üé¨ YouTube API Key</label>
                <input type="password" data-secret="YOUTUBE_API_KEY" placeholder="api_key...">
                <div class="secret-status" id="status-YOUTUBE_API_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üé¨ YouTube Channel ID</label>
                <input type="text" data-secret="YOUTUBE_CHANNEL_ID" placeholder="channel_id...">
                <div class="secret-status" id="status-YOUTUBE_CHANNEL_ID">Not configured</div>
            </div>

            <!-- LinkedIn -->
            <div class="secret-field">
                <label>üíº LinkedIn Client ID</label>
                <input type="password" data-secret="LINKEDIN_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-LINKEDIN_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üíº LinkedIn Client Secret</label>
                <input type="password" data-secret="LINKEDIN_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-LINKEDIN_CLIENT_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üíº LinkedIn Access Token</label>
                <input type="password" data-secret="LINKEDIN_ACCESS_TOKEN" placeholder="access_token...">
                <div class="secret-status" id="status-LINKEDIN_ACCESS_TOKEN">Not configured</div>
            </div>

            <!-- Snapchat -->
            <div class="secret-field">
                <label>üëª Snapchat Business Account ID</label>
                <input type="text" data-secret="SNAPCHAT_BUSINESS_ACCOUNT_ID" placeholder="account_id...">
                <div class="secret-status" id="status-SNAPCHAT_BUSINESS_ACCOUNT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üëª Snapchat Access Token</label>
                <input type="password" data-secret="SNAPCHAT_ACCESS_TOKEN" placeholder="access_token...">
                <div class="secret-status" id="status-SNAPCHAT_ACCESS_TOKEN">Not configured</div>
            </div>

            <!-- WooCommerce -->
            <div class="secret-field">
                <label>üõí WooCommerce Store URL</label>
                <input type="text" data-secret="WC_STORE_URL" placeholder="https://shop.example.com">
                <div class="secret-status" id="status-WC_STORE_URL">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üõí WooCommerce Consumer Key</label>
                <input type="password" data-secret="WC_CONSUMER_KEY" placeholder="ck_...">
                <div class="secret-status" id="status-WC_CONSUMER_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üõí WooCommerce Consumer Secret</label>
                <input type="password" data-secret="WC_CONSUMER_SECRET" placeholder="cs_...">
                <div class="secret-status" id="status-WC_CONSUMER_SECRET">Not configured</div>
            </div>

            <!-- ExoClick -->
            <div class="secret-field">
                <label>üì¢ ExoClick API Base URL</label>
                <input type="text" data-secret="EXOCLICK_API_BASE" placeholder="https://api.exoclick.com">
                <div class="secret-status" id="status-EXOCLICK_API_BASE">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üì¢ ExoClick API Token</label>
                <input type="password" data-secret="EXOCLICK_API_TOKEN" placeholder="token...">
                <div class="secret-status" id="status-EXOCLICK_API_TOKEN">Not configured</div>
            </div>

            <!-- TubeCorporate -->
            <div class="secret-field">
                <label>üé• TubeCorporate Campaign ID</label>
                <input type="text" data-secret="TUBECORPORATE_CAMPAIGN_ID" placeholder="campaign_id...">
                <div class="secret-status" id="status-TUBECORPORATE_CAMPAIGN_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üé• TubeCorporate DC</label>
                <input type="text" data-secret="TUBECORPORATE_DC" placeholder="dc...">
                <div class="secret-status" id="status-TUBECORPORATE_DC">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üé• TubeCorporate MC</label>
                <input type="text" data-secret="TUBECORPORATE_MC" placeholder="mc...">
                <div class="secret-status" id="status-TUBECORPORATE_MC">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üé• TubeCorporate Promo</label>
                <input type="text" data-secret="TUBECORPORATE_PROMO" placeholder="promo...">
                <div class="secret-status" id="status-TUBECORPORATE_PROMO">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üé• TubeCorporate TC</label>
                <input type="text" data-secret="TUBECORPORATE_TC" placeholder="tc...">
                <div class="secret-status" id="status-TUBECORPORATE_TC">Not configured</div>
            </div>

            <!-- Other -->
            <div class="secret-field">
                <label>üîê Encryption Master Key</label>
                <input type="password" data-secret="ENCRYPTION_MASTER_KEY" placeholder="master_key...">
                <div class="secret-status" id="status-ENCRYPTION_MASTER_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>üéØ ClickAdilla Token</label>
                <input type="password" data-secret="CLICKADILLA_TOKEN" placeholder="token...">
                <div class="secret-status" id="status-CLICKADILLA_TOKEN">Not configured</div>
            </div>
        </div>

        <button onclick="saveSecrets()">üîê Save All Secrets</button>
        <div id="secrets-message"></div>
    </div>

    <!-- OAuth Integrations Section -->
    <div id="oauth" class="section">
        <div class="section-header">
            <h2>OAuth & External Integrations</h2>
            <p class="section-desc">Connect your social media accounts and external services via OAuth</p>
        </div>

        <div class="secrets-grid">
            <!-- TikTok OAuth - Full Integration -->
            <div class="secret-field" id="tiktok-oauth-card" style="border: 2px solid #ff0050; position: relative;">
                <div style="position: absolute; top: -10px; right: 10px; background: #ff0050; color: #fff; font-size: 10px; padding: 2px 8px; border-radius: 4px;">OAuth</div>
                <label>üéµ TikTok</label>
                <div id="tiktok-status" style="margin: 10px 0;">
                    <p style="color: #888; font-size: 12px;">Loading status...</p>
                </div>
                <div id="tiktok-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <a href="{{ url_for('tiktok.connect') }}" id="tiktok-connect-btn" class="btn-oauth" style="display: none;" target="_blank" rel="noopener">
                        Connect TikTok
                    </a>
                    <button onclick="disconnectTikTok()" id="tiktok-disconnect-btn" class="btn-oauth btn-danger" style="display: none;">
                        Disconnect
                    </button>
                    <button onclick="refreshTikTok()" id="tiktok-refresh-btn" class="btn-oauth btn-secondary" style="display: none;">
                        Refresh Token
                    </button>
                    <a href="/tiktok/videos" id="tiktok-videos-btn" class="btn-oauth btn-secondary" style="display: none;">
                        View Videos
                    </a>
                </div>
            </div>

            <!-- Instagram OAuth - Full Integration -->
            <div class="secret-field" id="instagram-oauth-card" style="border: 2px solid #e4405f; position: relative;">
                <div style="position: absolute; top: -10px; right: 10px; background: #e4405f; color: #fff; font-size: 10px; padding: 2px 8px; border-radius: 4px;">OAuth</div>
                <label>üì∏ Instagram</label>
                <div id="instagram-status" style="margin: 10px 0;">
                    <p style="color: #888; font-size: 12px;">Loading status...</p>
                </div>
                <div id="instagram-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <a href="{{ url_for('instagram_auth.connect') }}" id="instagram-connect-btn" class="btn-oauth" style="display: none;" target="_blank" rel="noopener">
                        Connect Instagram
                    </a>
                    <button onclick="disconnectInstagram()" id="instagram-disconnect-btn" class="btn-oauth btn-danger" style="display: none;">
                        Disconnect
                    </button>
                    <button onclick="viewInstagramMedia()" id="instagram-media-btn" class="btn-oauth btn-secondary" style="display: none;">
                        View Media
                    </button>
                </div>
            </div>

            <!-- Facebook OAuth - Full Integration -->
            <div class="secret-field" id="facebook-oauth-card" style="border: 2px solid #1877f2; position: relative;">
                <div style="position: absolute; top: -10px; right: 10px; background: #1877f2; color: #fff; font-size: 10px; padding: 2px 8px; border-radius: 4px;">OAuth</div>
                <label>üëç Facebook</label>
                <div id="facebook-status" style="margin: 10px 0;">
                    <p style="color: #888; font-size: 12px;">Loading status...</p>
                </div>
                <div id="facebook-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <a href="{{ url_for('facebook_auth.connect') }}" id="facebook-connect-btn" class="btn-oauth" style="display: none;" target="_blank" rel="noopener">
                        Connect Facebook
                    </a>
                    <button onclick="disconnectFacebook()" id="facebook-disconnect-btn" class="btn-oauth btn-danger" style="display: none;">
                        Disconnect
                    </button>
                    <button onclick="viewFacebookPages()" id="facebook-pages-btn" class="btn-oauth btn-secondary" style="display: none;">
                        View Pages
                    </button>
                </div>
            </div>

            <!-- Twitter/X -->
            <div class="secret-field">
                <label>ùïè Twitter/X</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- YouTube -->
            <div class="secret-field">
                <label>üé¨ YouTube</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- LinkedIn -->
            <div class="secret-field">
                <label>üíº LinkedIn</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- Reddit -->
            <div class="secret-field">
                <label>ü§ñ Reddit</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- Snapchat -->
            <div class="secret-field">
                <label>üëª Snapchat</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- Google Analytics -->
            <div class="secret-field">
                <label>üìä Google Analytics</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- Google Ads -->
            <div class="secret-field">
                <label>üîç Google Ads</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- Microsoft 365 -->
            <div class="secret-field">
                <label>‚òÅÔ∏è Microsoft 365</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- OpenAI -->
            <div class="secret-field">
                <label>ü§ñ OpenAI</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>

            <!-- WooCommerce -->
            <div class="secret-field">
                <label>üõí WooCommerce</label>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Configure in API Keys & Secrets tab</p>
                <span class="secret-status">Manual API key setup</span>
            </div>
        </div>

        <p style="color: #666; text-align: center; margin-top: 30px; padding: 20px; background: #111; border-radius: 8px;">
            üîó <strong>TikTok</strong> uses full OAuth integration with Connect button above.<br>
            Other platforms use API keys configured in the <strong>API Keys & Secrets</strong> tab.
        </p>
        <div id="oauth-message"></div>
    </div>
</div>

<script src="https://unpkg.com/feather-icons"></script>
<script>
function switchCompany(companyId) {
    window.location.href = '/company/' + companyId + '/settings';
}

async function setDefaultCompany(companyId) {
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    try {
        const response = await fetch('/api/user/set-default-company', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ company_id: companyId })
        });
        const data = await response.json();
        if (data.success) {
            window.location.reload();
        } else {
            alert('Error setting default company: ' + data.error);
        }
    } catch (e) {
        alert('Error setting default company');
    }
}

function switchTab(tabName) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

async function loadSecrets() {
    const company_id = {{ company.id }};
    try {
        const response = await fetch(`/api/company/${company_id}/secrets`);
        const data = await response.json();
        
        if (data.success && data.secrets) {
            document.querySelectorAll('[data-secret]').forEach(field => {
                const key = field.getAttribute('data-secret');
                if (data.secrets.some(s => s.key === key)) {
                    document.getElementById(`status-${key}`).innerHTML = '‚úì Configured';
                    document.getElementById(`status-${key}`).classList.add('configured');
                }
            });
        }
    } catch (e) {
        console.error('Error loading secrets:', e);
    }
}

async function saveSecrets() {
    const company_id = {{ company.id }};
    const secrets = {};
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    document.querySelectorAll('[data-secret]').forEach(field => {
        const key = field.getAttribute('data-secret');
        if (field.value) {
            secrets[key] = field.value;
        }
    });
    
    try {
        const response = await fetch(`/api/company/${company_id}/secrets/save`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(secrets)
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('secrets-message').innerHTML = '<div class="success">‚úì Secrets saved successfully!</div>';
            loadSecrets();
        } else {
            document.getElementById('secrets-message').innerHTML = '<div class="error">‚úó Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('secrets-message').innerHTML = '<div class="error">‚úó Error saving secrets</div>';
    }
}

async function saveBrandSettings() {
    const company_id = {{ company.id }};
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    const settings = {
        primary_color: document.getElementById('primary_color').value,
        secondary_color: document.getElementById('secondary_color').value,
        accent_color: document.getElementById('accent_color').value,
        font_family: document.getElementById('font_family').value,
        website_url: document.getElementById('website_url').value,
        logo_path: document.getElementById('logo_path').value
    };
    
    try {
        const response = await fetch(`/api/company/${company_id}/settings`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(settings)
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('brand-message').innerHTML = '<div class="success">‚úì Settings saved successfully!</div>';
        } else {
            document.getElementById('brand-message').innerHTML = '<div class="error">‚úó Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('brand-message').innerHTML = '<div class="error">‚úó Error saving settings</div>';
    }
}

async function loadTikTokStatus() {
    try {
        const response = await fetch('/auth/tiktok/status');
        const data = await response.json();
        
        const statusDiv = document.getElementById('tiktok-status');
        const connectBtn = document.getElementById('tiktok-connect-btn');
        const disconnectBtn = document.getElementById('tiktok-disconnect-btn');
        const refreshBtn = document.getElementById('tiktok-refresh-btn');
        const videosBtn = document.getElementById('tiktok-videos-btn');
        
        if (data.connected) {
            let statusHtml = '';
            if (data.avatar_url) {
                statusHtml += `<img src="${data.avatar_url}" class="tiktok-avatar" alt="Avatar">`;
            }
            statusHtml += `<span class="tiktok-connected">Connected as ${data.display_name || data.open_id}</span>`;
            
            if (data.is_expired) {
                statusHtml += `<br><span class="tiktok-expired">‚ö†Ô∏è Token expired - please refresh or reconnect</span>`;
            } else if (data.needs_refresh) {
                statusHtml += `<br><span style="color: #ffc107;">‚è∞ Token expires soon - consider refreshing</span>`;
            }
            
            if (data.expires_at) {
                const expiresAt = new Date(data.expires_at);
                statusHtml += `<br><small style="color: #666;">Expires: ${expiresAt.toLocaleDateString()}</small>`;
            }
            
            statusDiv.innerHTML = statusHtml;
            
            connectBtn.style.display = 'none';
            disconnectBtn.style.display = 'inline-block';
            refreshBtn.style.display = 'inline-block';
            videosBtn.style.display = 'inline-block';
        } else {
            statusDiv.innerHTML = '<p style="color: #888; font-size: 12px;">Not connected. Click Connect to authorize TikTok access.</p>';
            connectBtn.style.display = 'inline-block';
            disconnectBtn.style.display = 'none';
            refreshBtn.style.display = 'none';
            videosBtn.style.display = 'none';
        }
    } catch (e) {
        console.error('Error loading TikTok status:', e);
        document.getElementById('tiktok-status').innerHTML = '<p style="color: #ff6b6b; font-size: 12px;">Error loading status</p>';
        document.getElementById('tiktok-connect-btn').style.display = 'inline-block';
    }
}

async function disconnectTikTok() {
    if (!confirm('Are you sure you want to disconnect your TikTok account?')) {
        return;
    }
    
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    try {
        const response = await fetch('/auth/tiktok/disconnect', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('oauth-message').innerHTML = '<div class="success">‚úì TikTok disconnected successfully!</div>';
            loadTikTokStatus();
        } else {
            document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error disconnecting TikTok</div>';
    }
}

async function refreshTikTok() {
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    try {
        document.getElementById('tiktok-refresh-btn').disabled = true;
        document.getElementById('tiktok-refresh-btn').textContent = 'Refreshing...';
        
        const response = await fetch('/auth/tiktok/refresh', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('oauth-message').innerHTML = '<div class="success">‚úì TikTok token refreshed successfully!</div>';
            loadTikTokStatus();
        } else {
            document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error refreshing token</div>';
    } finally {
        document.getElementById('tiktok-refresh-btn').disabled = false;
        document.getElementById('tiktok-refresh-btn').textContent = 'Refresh Token';
    }
}

async function loadInstagramStatus() {
    try {
        const response = await fetch('/auth/instagram/status');
        const data = await response.json();
        
        const statusDiv = document.getElementById('instagram-status');
        const connectBtn = document.getElementById('instagram-connect-btn');
        const disconnectBtn = document.getElementById('instagram-disconnect-btn');
        const mediaBtn = document.getElementById('instagram-media-btn');
        
        if (data.connected) {
            let statusHtml = `<p style="color: #00ff88; font-size: 12px;"><strong>Connected</strong></p>`;
            
            if (data.avatar_url) {
                statusHtml += `<img src="${data.avatar_url}" alt="Profile" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 8px; vertical-align: middle;">`;
            }
            if (data.username) {
                statusHtml += `<span style="color: #fff;">@${data.username}</span>`;
            }
            
            if (data.expires_at) {
                const expiresAt = new Date(data.expires_at);
                statusHtml += `<br><small style="color: #666;">Expires: ${expiresAt.toLocaleDateString()}</small>`;
            }
            
            statusDiv.innerHTML = statusHtml;
            
            connectBtn.style.display = 'none';
            disconnectBtn.style.display = 'inline-block';
            mediaBtn.style.display = 'inline-block';
        } else {
            statusDiv.innerHTML = '<p style="color: #888; font-size: 12px;">Not connected. Click Connect to authorize Instagram access.</p>';
            connectBtn.style.display = 'inline-block';
            disconnectBtn.style.display = 'none';
            mediaBtn.style.display = 'none';
        }
    } catch (e) {
        console.error('Error loading Instagram status:', e);
        document.getElementById('instagram-status').innerHTML = '<p style="color: #ff6b6b; font-size: 12px;">Error loading status</p>';
        document.getElementById('instagram-connect-btn').style.display = 'inline-block';
    }
}

async function disconnectInstagram() {
    if (!confirm('Are you sure you want to disconnect your Instagram account?')) {
        return;
    }
    
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    try {
        const response = await fetch('/auth/instagram/disconnect', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('oauth-message').innerHTML = '<div class="success">‚úì Instagram disconnected successfully!</div>';
            loadInstagramStatus();
        } else {
            document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error disconnecting Instagram</div>';
    }
}

async function viewInstagramMedia() {
    try {
        const response = await fetch('/auth/instagram/media');
        const data = await response.json();
        
        if (data.success && data.media) {
            alert('Instagram Media:\n' + data.media.slice(0, 5).map(m => m.caption || 'No caption').join('\n'));
        } else {
            alert('Error: ' + (data.error || 'Could not load media'));
        }
    } catch (e) {
        alert('Error loading Instagram media');
    }
}

async function loadFacebookStatus() {
    try {
        const response = await fetch('/auth/facebook/status');
        const data = await response.json();
        
        const statusDiv = document.getElementById('facebook-status');
        const connectBtn = document.getElementById('facebook-connect-btn');
        const disconnectBtn = document.getElementById('facebook-disconnect-btn');
        const pagesBtn = document.getElementById('facebook-pages-btn');
        
        if (data.connected) {
            let statusHtml = `<p style="color: #00ff88; font-size: 12px;"><strong>Connected</strong></p>`;
            
            if (data.avatar_url) {
                statusHtml += `<img src="${data.avatar_url}" alt="Profile" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 8px; vertical-align: middle;">`;
            }
            if (data.display_name) {
                statusHtml += `<span style="color: #fff;">${data.display_name}</span>`;
            }
            
            if (data.expires_at) {
                const expiresAt = new Date(data.expires_at);
                statusHtml += `<br><small style="color: #666;">Expires: ${expiresAt.toLocaleDateString()}</small>`;
            }
            
            statusDiv.innerHTML = statusHtml;
            
            connectBtn.style.display = 'none';
            disconnectBtn.style.display = 'inline-block';
            pagesBtn.style.display = 'inline-block';
        } else {
            statusDiv.innerHTML = '<p style="color: #888; font-size: 12px;">Not connected. Click Connect to authorize Facebook access.</p>';
            connectBtn.style.display = 'inline-block';
            disconnectBtn.style.display = 'none';
            pagesBtn.style.display = 'none';
        }
    } catch (e) {
        console.error('Error loading Facebook status:', e);
        document.getElementById('facebook-status').innerHTML = '<p style="color: #ff6b6b; font-size: 12px;">Error loading status</p>';
        document.getElementById('facebook-connect-btn').style.display = 'inline-block';
    }
}

async function disconnectFacebook() {
    if (!confirm('Are you sure you want to disconnect your Facebook account?')) {
        return;
    }
    
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    try {
        const response = await fetch('/auth/facebook/disconnect', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('oauth-message').innerHTML = '<div class="success">‚úì Facebook disconnected successfully!</div>';
            loadFacebookStatus();
        } else {
            document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('oauth-message').innerHTML = '<div class="error">‚úó Error disconnecting Facebook</div>';
    }
}

async function viewFacebookPages() {
    try {
        const response = await fetch('/auth/facebook/pages');
        const data = await response.json();
        
        if (data.success && data.pages) {
            let pagesHtml = '<h4>Your Facebook Pages:</h4><ul>';
            data.pages.forEach(page => {
                pagesHtml += `<li><strong>${page.name}</strong> (${page.category || 'Page'})</li>`;
            });
            pagesHtml += '</ul>';
            alert('Facebook Pages:\n' + data.pages.map(p => p.name).join('\n'));
        } else {
            alert('Error: ' + (data.error || 'Could not load pages'));
        }
    } catch (e) {
        alert('Error loading Facebook pages');
    }
}

window.addEventListener('load', () => {
    loadSecrets();
    loadTikTokStatus();
    loadInstagramStatus();
    loadFacebookStatus();
    feather.replace();
});
</script>
{% endblock %}
