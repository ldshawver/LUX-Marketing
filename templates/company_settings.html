<!DOCTYPE html>
<html>
<head>
    <title>Company Settings & Integrations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000000; color: #ffffff; font-family: Inter, sans-serif; }
        .navbar { background: #111; border-bottom: 1px solid #333; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .navbar-brand { font-size: 20px; font-weight: bold; color: #bc00ed; }
        .navbar-menu { display: flex; gap: 30px; }
        .navbar-menu a { color: #888; text-decoration: none; font-size: 14px; transition: color 0.3s; }
        .navbar-menu a:hover { color: #00ffb4; }
        .navbar-menu a.active { color: #bc00ed; border-bottom: 2px solid #bc00ed; padding-bottom: 5px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .header { margin-bottom: 40px; }
        h1 { font-size: 32px; margin-bottom: 10px; color: #bc00ed; }
        .tabs { display: flex; gap: 20px; margin-bottom: 30px; border-bottom: 1px solid #333; }
        .tab { padding: 15px; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab.active { border-bottom-color: #bc00ed; color: #bc00ed; }
        .section { display: none; }
        .section.active { display: block; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #00ffb4; }
        input, textarea { width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; border-radius: 6px; }
        input:focus, textarea:focus { outline: none; border-color: #bc00ed; }
        .secrets-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .secret-field { background: #111; padding: 20px; border-radius: 8px; border: 1px solid #333; }
        .secret-field label { margin-bottom: 10px; }
        .secret-field input { margin-bottom: 8px; }
        .secret-status { font-size: 12px; margin-top: 5px; color: #888; }
        .secret-status.configured { color: #00ffb4; }
        button { background: #bc00ed; color: #fff; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-weight: 600; margin-top: 20px; }
        button:hover { background: #9a00c0; }
        .success { color: #00ffb4; margin-top: 20px; padding: 15px; background: #001a1a; border-radius: 6px; }
        .error { color: #ff0066; margin-top: 20px; padding: 15px; background: #1a0011; border-radius: 6px; }
        .section-desc { color: #888; margin-bottom: 30px; font-size: 14px; }
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .two-col { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="navbar">
    <div class="navbar-brand">ğŸ›ï¸ LUX Marketing</div>
    <div class="navbar-menu">
        <a href="/">ğŸ“Š Dashboard</a>
        <a href="/email-hub">ğŸ“§ Email Hub</a>
        <a href="/campaign-hub">ğŸš€ Campaigns</a>
        <a href="/ai-dashboard">ğŸ¤– AI Agents</a>
        <a href="/crm">ğŸ‘¥ CRM</a>
        <a href="/settings/integrations" class="active">âš™ï¸ Settings</a>
    </div>
</div>

<div class="container">
    <div class="header">
        <h1>ğŸ›ï¸ {{ company.name }} - Settings & Integrations</h1>
        <p style="color: #888; margin-top: 10px;">Manage all API keys, tokens, and external service integrations</p>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('brand')">Brand Settings</div>
        <div class="tab" onclick="switchTab('secrets')">API Keys & Secrets</div>
        <div class="tab" onclick="switchTab('oauth')">OAuth Integrations</div>
    </div>

    <!-- Brand Settings Section -->
    <div id="brand" class="section active">
        <h2 style="margin-bottom: 20px;">Brand Customization</h2>
        <div class="two-col">
            <div class="form-group">
                <label>Primary Color (Purple)</label>
                <input type="color" id="primary_color" value="{{ company.primary_color or '#bc00ed' }}">
            </div>
            <div class="form-group">
                <label>Secondary Color (Cyan)</label>
                <input type="color" id="secondary_color" value="{{ company.secondary_color or '#00ffb4' }}">
            </div>
            <div class="form-group">
                <label>Accent Color (Pink)</label>
                <input type="color" id="accent_color" value="{{ company.accent_color or '#e4055c' }}">
            </div>
            <div class="form-group">
                <label>Font Family</label>
                <input type="text" id="font_family" value="{{ company.font_family or 'Inter, sans-serif' }}">
            </div>
            <div class="form-group">
                <label>Website URL</label>
                <input type="text" id="website_url" value="{{ company.website_url or '' }}">
            </div>
            <div class="form-group">
                <label>Logo Path</label>
                <input type="text" id="logo_path" value="{{ company.logo_path or '' }}">
            </div>
        </div>
        <button onclick="saveBrandSettings()">ğŸ’¾ Save Brand Settings</button>
        <div id="brand-message"></div>
    </div>

    <!-- API Keys & Secrets Section -->
    <div id="secrets" class="section">
        <h2 style="margin-bottom: 10px;">API Keys & Secrets</h2>
        <p class="section-desc">All secrets are encrypted and stored securely. Never share your API keys.</p>
        
        <div class="secrets-grid">
            <!-- OpenAI -->
            <div class="secret-field">
                <label>ğŸ¤– OpenAI API Key</label>
                <input type="password" data-secret="OPENAI_API_KEY" placeholder="sk-proj-...">
                <div class="secret-status" id="status-OPENAI_API_KEY">Not configured</div>
            </div>

            <!-- Google -->
            <div class="secret-field">
                <label>ğŸ“Š GA4 Property ID</label>
                <input type="text" data-secret="GA4_PROPERTY_ID" placeholder="123456789">
                <div class="secret-status" id="status-GA4_PROPERTY_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ“Š GA4 Service Account JSON</label>
                <textarea data-secret="GA4_SERVICE_ACCOUNT_JSON" placeholder="{...}" rows="4"></textarea>
                <div class="secret-status" id="status-GA4_SERVICE_ACCOUNT_JSON">Not configured</div>
            </div>

            <!-- Google Ads -->
            <div class="secret-field">
                <label>ğŸ” Google Ads Client ID</label>
                <input type="text" data-secret="GOOGLE_ADS_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-GOOGLE_ADS_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ” Google Ads Client Secret</label>
                <input type="password" data-secret="GOOGLE_ADS_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-GOOGLE_ADS_CLIENT_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ” Google Ads Customer ID</label>
                <input type="text" data-secret="GOOGLE_ADS_CUSTOMER_ID" placeholder="1234567890">
                <div class="secret-status" id="status-GOOGLE_ADS_CUSTOMER_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ” Google Ads Developer Token</label>
                <input type="password" data-secret="GOOGLE_ADS_DEVELOPER_TOKEN" placeholder="developer_token...">
                <div class="secret-status" id="status-GOOGLE_ADS_DEVELOPER_TOKEN">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ” Google Ads Refresh Token</label>
                <input type="password" data-secret="GOOGLE_ADS_REFRESH_TOKEN" placeholder="refresh_token...">
                <div class="secret-status" id="status-GOOGLE_ADS_REFRESH_TOKEN">Not configured</div>
            </div>

            <!-- Microsoft 365 -->
            <div class="secret-field">
                <label>â˜ï¸ Microsoft 365 Client ID</label>
                <input type="text" data-secret="MS365_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-MS365_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>â˜ï¸ Microsoft 365 Client Secret</label>
                <input type="password" data-secret="MS365_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-MS365_CLIENT_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>â˜ï¸ Microsoft 365 Tenant ID</label>
                <input type="text" data-secret="MS365_TENANT_ID" placeholder="tenant_id...">
                <div class="secret-status" id="status-MS365_TENANT_ID">Not configured</div>
            </div>

            <!-- Twitter/X -->
            <div class="secret-field">
                <label>ğ• Twitter API Key</label>
                <input type="password" data-secret="TWITTER_API_KEY" placeholder="api_key...">
                <div class="secret-status" id="status-TWITTER_API_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğ• Twitter API Secret</label>
                <input type="password" data-secret="TWITTER_API_SECRET" placeholder="api_secret...">
                <div class="secret-status" id="status-TWITTER_API_SECRET">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğ• Twitter Bearer Token</label>
                <input type="password" data-secret="TWITTER_BEARER_TOKEN" placeholder="bearer_token...">
                <div class="secret-status" id="status-TWITTER_BEARER_TOKEN">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğ• Twitter Client ID</label>
                <input type="text" data-secret="TWITTER_CLIENT_ID" placeholder="client_id...">
                <div class="secret-status" id="status-TWITTER_CLIENT_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğ• Twitter Client Secret</label>
                <input type="password" data-secret="TWITTER_CLIENT_SECRET" placeholder="client_secret...">
                <div class="secret-status" id="status-TWITTER_CLIENT_SECRET">Not configured</div>
            </div>

            <!-- WooCommerce -->
            <div class="secret-field">
                <label>ğŸ›’ WooCommerce Store URL</label>
                <input type="text" data-secret="WC_STORE_URL" placeholder="https://shop.example.com">
                <div class="secret-status" id="status-WC_STORE_URL">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ›’ WooCommerce Consumer Key</label>
                <input type="password" data-secret="WC_CONSUMER_KEY" placeholder="ck_...">
                <div class="secret-status" id="status-WC_CONSUMER_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ›’ WooCommerce Consumer Secret</label>
                <input type="password" data-secret="WC_CONSUMER_SECRET" placeholder="cs_...">
                <div class="secret-status" id="status-WC_CONSUMER_SECRET">Not configured</div>
            </div>

            <!-- ExoClick -->
            <div class="secret-field">
                <label>ğŸ“¢ ExoClick API Base URL</label>
                <input type="text" data-secret="EXOCLICK_API_BASE" placeholder="https://api.exoclick.com">
                <div class="secret-status" id="status-EXOCLICK_API_BASE">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ“¢ ExoClick API Token</label>
                <input type="password" data-secret="EXOCLICK_API_TOKEN" placeholder="token...">
                <div class="secret-status" id="status-EXOCLICK_API_TOKEN">Not configured</div>
            </div>

            <!-- TubeCorporate -->
            <div class="secret-field">
                <label>ğŸ¥ TubeCorporate Campaign ID</label>
                <input type="text" data-secret="TUBECORPORATE_CAMPAIGN_ID" placeholder="campaign_id...">
                <div class="secret-status" id="status-TUBECORPORATE_CAMPAIGN_ID">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ¥ TubeCorporate DC</label>
                <input type="text" data-secret="TUBECORPORATE_DC" placeholder="dc...">
                <div class="secret-status" id="status-TUBECORPORATE_DC">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ¥ TubeCorporate MC</label>
                <input type="text" data-secret="TUBECORPORATE_MC" placeholder="mc...">
                <div class="secret-status" id="status-TUBECORPORATE_MC">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ¥ TubeCorporate Promo</label>
                <input type="text" data-secret="TUBECORPORATE_PROMO" placeholder="promo...">
                <div class="secret-status" id="status-TUBECORPORATE_PROMO">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ¥ TubeCorporate TC</label>
                <input type="text" data-secret="TUBECORPORATE_TC" placeholder="tc...">
                <div class="secret-status" id="status-TUBECORPORATE_TC">Not configured</div>
            </div>

            <!-- Other -->
            <div class="secret-field">
                <label>ğŸ” Encryption Master Key</label>
                <input type="password" data-secret="ENCRYPTION_MASTER_KEY" placeholder="master_key...">
                <div class="secret-status" id="status-ENCRYPTION_MASTER_KEY">Not configured</div>
            </div>
            <div class="secret-field">
                <label>ğŸ¯ ClickAdilla Token</label>
                <input type="password" data-secret="CLICKADILLA_TOKEN" placeholder="token...">
                <div class="secret-status" id="status-CLICKADILLA_TOKEN">Not configured</div>
            </div>
        </div>

        <button onclick="saveSecrets()">ğŸ” Save All Secrets</button>
        <div id="secrets-message"></div>
    </div>

    <!-- OAuth Integrations Section -->
    <div id="oauth" class="section">
        <h2 style="margin-bottom: 20px;">OAuth & External Integrations</h2>
        <p class="section-desc">Connect your external services and applications</p>
        <div style="background: #111; padding: 30px; border-radius: 8px; border: 1px solid #333; text-align: center;">
            <p style="color: #888; margin-bottom: 20px;">All OAuth integrations are configured through the API Keys & Secrets tab above.</p>
            <p style="color: #666; font-size: 14px;">Currently configured integrations:</p>
            <div id="oauth-list" style="margin-top: 20px; text-align: left; display: inline-block;">
                <p>âœ“ OpenAI ChatGPT</p>
                <p>âœ“ Google Analytics</p>
                <p>âœ“ Google Ads</p>
                <p>âœ“ Microsoft 365</p>
                <p>âœ“ Twitter/X</p>
                <p>âœ“ WooCommerce</p>
            </div>
        </div>
    </div>
</div>

<script>
function switchTab(tabName) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

async function loadSecrets() {
    const company_id = {{ company.id }};
    try {
        const response = await fetch(`/api/company/${company_id}/secrets`);
        const data = await response.json();
        
        if (data.success && data.secrets) {
            document.querySelectorAll('[data-secret]').forEach(field => {
                const key = field.getAttribute('data-secret');
                if (data.secrets.some(s => s.key === key)) {
                    document.getElementById(`status-${key}`).innerHTML = 'âœ“ Configured';
                    document.getElementById(`status-${key}`).classList.add('configured');
                }
            });
        }
    } catch (e) {
        console.error('Error loading secrets:', e);
    }
}

async function saveSecrets() {
    const company_id = {{ company.id }};
    const secrets = {};
    
    document.querySelectorAll('[data-secret]').forEach(field => {
        const key = field.getAttribute('data-secret');
        if (field.value) {
            secrets[key] = field.value;
        }
    });
    
    try {
        const response = await fetch(`/api/company/${company_id}/secrets/save`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(secrets)
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('secrets-message').innerHTML = '<div class="success">âœ“ Secrets saved successfully!</div>';
            loadSecrets();
        } else {
            document.getElementById('secrets-message').innerHTML = '<div class="error">âœ— Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('secrets-message').innerHTML = '<div class="error">âœ— Error saving secrets</div>';
    }
}

async function saveBrandSettings() {
    const company_id = {{ company.id }};
    const settings = {
        primary_color: document.getElementById('primary_color').value,
        secondary_color: document.getElementById('secondary_color').value,
        accent_color: document.getElementById('accent_color').value,
        font_family: document.getElementById('font_family').value,
        website_url: document.getElementById('website_url').value,
        logo_path: document.getElementById('logo_path').value
    };
    
    try {
        const response = await fetch(`/api/company/${company_id}/settings`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
        
        const data = await response.json();
        if (data.success) {
            document.getElementById('brand-message').innerHTML = '<div class="success">âœ“ Settings saved successfully!</div>';
        } else {
            document.getElementById('brand-message').innerHTML = '<div class="error">âœ— Error: ' + data.error + '</div>';
        }
    } catch (e) {
        document.getElementById('brand-message').innerHTML = '<div class="error">âœ— Error saving settings</div>';
    }
}

// Load secrets on page load
window.onload = loadSecrets;
</script>
</body>
</html>
