{% extends "base.html" %}
{% block title %}AI Content Generator - LUX Marketing{% endblock %}
{% block content %}
<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="mb-2">
        <i data-feather="edit-3"></i> AI Content Generator
      </h1>
      <p class="text-muted">Generate high-quality marketing content powered by GPT-4</p>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-4">
      <div class="card mb-4" style="background: #0a0a0a; border: 2px solid #480749;">
        <div class="card-body">
          <h5 class="card-title mb-4" style="color: #00ffb4;">Content Settings</h5>
          
          <div class="mb-3">
            <label class="form-label" style="color: #c0c0c0;">Content Type</label>
            <select class="form-select" id="contentType" style="background: #000; border-color: #bc00ed; color: #fff;">
              <option value="blog_post">Blog Post</option>
              <option value="social_media">Social Media Posts</option>
              <option value="email_campaign">Email Campaign</option>
              <option value="ad_copy">Advertisement Copy</option>
              <option value="seo_content">SEO Content</option>
              <option value="product_description">Product Description</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label" style="color: #c0c0c0;">Topic <span style="color: #e4055c;">*</span></label>
            <input type="text" class="form-control" id="topic" placeholder="Enter your topic..." style="background: #000; border-color: #bc00ed; color: #fff;">
          </div>

          <div class="mb-3">
            <label class="form-label" style="color: #c0c0c0;">Tone</label>
            <select class="form-select" id="tone" style="background: #000; border-color: #bc00ed; color: #fff;">
              <option value="professional">Professional</option>
              <option value="casual">Casual</option>
              <option value="friendly">Friendly</option>
              <option value="urgent">Urgent</option>
              <option value="enthusiastic">Enthusiastic</option>
              <option value="informative">Informative</option>
              <option value="persuasive">Persuasive</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label" style="color: #c0c0c0;">Length</label>
            <select class="form-select" id="length" style="background: #000; border-color: #bc00ed; color: #fff;">
              <option value="short">Short (300-500 words)</option>
              <option value="medium" selected>Medium (500-800 words)</option>
              <option value="long">Long (800-1200 words)</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label" style="color: #c0c0c0;">Keywords (comma separated)</label>
            <input type="text" class="form-control" id="keywords" placeholder="AI, marketing, automation" style="background: #000; border-color: #bc00ed; color: #fff;">
          </div>

          <div class="mb-4">
            <label class="form-label" style="color: #c0c0c0;">Additional Context</label>
            <textarea class="form-control" id="context" rows="3" placeholder="Target audience, platform, special instructions..." style="background: #000; border-color: #bc00ed; color: #fff;"></textarea>
          </div>

          <button class="btn w-100" id="generateBtn" onclick="generateContent()" style="background: linear-gradient(135deg, #bc00ed, #0044ff); border: none; padding: 0.75rem; font-weight: 600;">
            <i data-feather="zap"></i> Generate Content
          </button>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card" style="background: #0a0a0a; border: 2px solid #480749; min-height: 600px;">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title mb-0" style="color: #00ffb4;">Generated Content</h5>
            <div class="dropdown" id="exportDropdown" style="display: none;">
              <button class="btn btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" style="background: linear-gradient(135deg, #bc00ed, #0044ff); border: none; color: #fff;">
                <i data-feather="download"></i> Export
              </button>
              <ul class="dropdown-menu dropdown-menu-end" style="background: #0a0a0a; border: 2px solid #bc00ed;">
                <li><a class="dropdown-item" href="#" onclick="copyContent(); return false;" style="color: #00ffb4;">
                  <i data-feather="copy"></i> Copy to Clipboard
                </a></li>
                <li><a class="dropdown-item" href="#" onclick="exportTXT(); return false;" style="color: #00ffb4;">
                  <i data-feather="file-text"></i> Download as TXT
                </a></li>
                <li><a class="dropdown-item" href="#" onclick="exportDOCX(); return false;" style="color: #00ffb4;">
                  <i data-feather="file"></i> Download as DOCX
                </a></li>
                <li><a class="dropdown-item" href="#" onclick="exportPDF(); return false;" style="color: #00ffb4;">
                  <i data-feather="file-text"></i> Download as PDF
                </a></li>
              </ul>
            </div>
          </div>

          <div id="loadingIndicator" style="display: none; text-align: center; padding: 4rem;">
            <div class="spinner-border" role="status" style="color: #bc00ed; width: 3rem; height: 3rem;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3" style="color: #00ffb4;">Generating your content...</p>
          </div>

          <div id="emptyState" style="text-align: center; padding: 4rem;">
            <i data-feather="file-text" style="width: 64px; height: 64px; color: #480749; margin-bottom: 1rem;"></i>
            <h4 style="color: #c0c0c0;">No content generated yet</h4>
            <p class="text-muted">Fill in the settings and click "Generate Content" to create amazing marketing content</p>
          </div>

          <div id="contentOutput" style="display: none; padding: 1.5rem; background: #000; border: 1px solid #bc00ed; border-radius: 8px; white-space: pre-wrap; color: #fff; max-height: 500px; overflow-y: auto;">
          </div>

          <div id="metaInfo" style="display: none; margin-top: 1rem; padding: 1rem; background: #000; border: 1px solid #00ffb4; border-radius: 8px;">
            <small style="color: #00ffb4;">
              <strong>Type:</strong> <span id="metaType"></span> | 
              <strong>Tone:</strong> <span id="metaTone"></span> | 
              <strong>Length:</strong> <span id="metaLength"></span> | 
              <strong>Tokens Used:</strong> <span id="metaTokens"></span>
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
feather.replace();

async function generateContent() {
  const topic = document.getElementById('topic').value.trim();
  
  if (!topic) {
    alert('Please enter a topic');
    return;
  }

  const contentType = document.getElementById('contentType').value;
  const tone = document.getElementById('tone').value;
  const length = document.getElementById('length').value;
  const keywordsInput = document.getElementById('keywords').value.trim();
  const keywords = keywordsInput ? keywordsInput.split(',').map(k => k.trim()) : [];
  const context = document.getElementById('context').value.trim();

  // Show loading state
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('contentOutput').style.display = 'none';
  document.getElementById('metaInfo').style.display = 'none';
  document.getElementById('loadingIndicator').style.display = 'block';
  document.getElementById('exportDropdown').style.display = 'none';
  document.getElementById('generateBtn').disabled = true;

  try {
    const response = await fetch('/api/content/generate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        type: contentType,
        topic: topic,
        tone: tone,
        length: length,
        keywords: keywords,
        context: context
      })
    });

    const data = await response.json();

    if (response.ok && data.success) {
      // Display content
      document.getElementById('contentOutput').textContent = data.content;
      document.getElementById('contentOutput').style.display = 'block';
      
      // Display metadata
      document.getElementById('metaType').textContent = data.type;
      document.getElementById('metaTone').textContent = data.tone;
      document.getElementById('metaLength').textContent = data.length;
      document.getElementById('metaTokens').textContent = data.tokens_used;
      document.getElementById('metaInfo').style.display = 'block';
      
      // Show export dropdown
      document.getElementById('exportDropdown').style.display = 'inline-block';
      
      feather.replace();
    } else {
      alert('Error: ' + (data.error || 'Failed to generate content'));
      document.getElementById('emptyState').style.display = 'block';
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Failed to generate content. Please try again.');
    document.getElementById('emptyState').style.display = 'block';
  } finally {
    document.getElementById('loadingIndicator').style.display = 'none';
    document.getElementById('generateBtn').disabled = false;
  }
}

function copyContent() {
  const content = document.getElementById('contentOutput').textContent;
  navigator.clipboard.writeText(content).then(() => {
    alert('Content copied to clipboard!');
  });
}

function exportTXT() {
  const content = document.getElementById('contentOutput').textContent;
  const topic = document.getElementById('topic').value.trim();
  const type = document.getElementById('contentType').value;
  
  const blob = new Blob([content], { type: 'text/plain' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${type}_${topic.replace(/\s+/g, '_').substring(0, 30)}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  window.URL.revokeObjectURL(url);
}

async function exportDOCX() {
  const content = document.getElementById('contentOutput').textContent;
  const topic = document.getElementById('topic').value.trim();
  const type = document.getElementById('contentType').value;
  
  try {
    const response = await fetch('/api/content/export/docx', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        content: content,
        title: topic,
        type: type
      })
    });
    
    if (response.ok) {
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${type}_${topic.replace(/\s+/g, '_').substring(0, 30)}.docx`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    } else {
      alert('Failed to export as DOCX');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Failed to export as DOCX');
  }
}

async function exportPDF() {
  const content = document.getElementById('contentOutput').textContent;
  const topic = document.getElementById('topic').value.trim();
  const type = document.getElementById('contentType').value;
  
  try {
    const response = await fetch('/api/content/export/pdf', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        content: content,
        title: topic,
        type: type
      })
    });
    
    if (response.ok) {
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${type}_${topic.replace(/\s+/g, '_').substring(0, 30)}.pdf`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    } else {
      alert('Failed to export as PDF');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Failed to export as PDF');
  }
}
</script>
{% endblock %}
