{% extends "base.html" %}

{% block title %}Poll Results - {{ poll.question }} - LUX Marketing{% endblock %}

{% block content %}
<div class="mb-4">
    <a href="{{ url_for('main.polls_management') }}" class="btn btn-outline-secondary">
        <i data-feather="arrow-left"></i> Back to Polls
    </a>
</div>

<div class="card">
    <div class="card-body">
        <h2 class="mb-4">{{ poll.question }}</h2>
        
        <div class="mb-3">
            <span class="badge bg-primary">{{ poll.poll_type }}</span>
            <span class="badge bg-info">{{ responses|length }} responses</span>
        </div>
        
        {% if poll.poll_type == 'multiple_choice' %}
            <h4 class="mt-4 mb-3">Results Breakdown</h4>
            <div class="row">
                {% for option, count in results.items() %}
                <div class="col-md-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5>{{ option }}</h5>
                            <div class="progress" style="height: 30px;">
                                <div class="progress-bar bg-primary" role="progressbar" 
                                     style="width: {{ (count / responses|length * 100) if responses else 0 }}%">
                                    {{ count }} ({{ "%.1f"|format(count / responses|length * 100) if responses else 0 }}%)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        
        {% elif poll.poll_type == 'rating' %}
            <div class="text-center py-5">
                <h1 class="display-1 text-primary">{{ "%.1f"|format(results.get('average', 0)) }}</h1>
                <p class="lead">Average Rating</p>
                <p class="text-muted">Based on {{ results.get('total', 0) }} responses</p>
            </div>
            
        {% elif poll.poll_type == 'text' %}
            <h4 class="mt-4 mb-3">Responses</h4>
            <div class="list-group">
                {% for response in responses %}
                <div class="list-group-item">
                    <p class="mb-1">{{ response.response_data.get('text', 'No response') }}</p>
                    <small class="text-muted">
                        <i data-feather="calendar" style="width: 14px; height: 14px;"></i>
                        {{ response.created_at.strftime('%Y-%m-%d %H:%M') }}
                    </small>
                </div>
                {% endfor %}
            </div>
        {% endif %}
        
        {% if not responses %}
        <div class="text-center py-5">
            <i data-feather="inbox" class="text-muted" style="width: 4rem; height: 4rem;"></i>
            <h3 class="mt-3">No Responses Yet</h3>
            <p class="text-muted">Share this poll with your audience to start collecting responses.</p>
        </div>
        {% endif %}
    </div>
</div>

{% if responses %}
<div class="card mt-4">
    <div class="card-body">
        <h4 class="mb-3">Individual Responses</h4>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Contact</th>
                        <th>Response</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for response in responses %}
                    <tr>
                        <td>
                            {% if response.contact %}
                                {{ response.contact.email }}
                            {% else %}
                                Anonymous
                            {% endif %}
                        </td>
                        <td>
                            {% if poll.poll_type == 'multiple_choice' %}
                                {{ response.response_data.get('answer', 'N/A') }}
                            {% elif poll.poll_type == 'rating' %}
                                â­ {{ response.response_data.get('rating', 'N/A') }}/5
                            {% elif poll.poll_type == 'text' %}
                                {{ response.response_data.get('text', 'N/A')[:50] }}{% if response.response_data.get('text', '')|length > 50 %}...{% endif %}
                            {% endif %}
                        </td>
                        <td>{{ response.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}
