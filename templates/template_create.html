{% extends "base.html" %}

{% block title %}Create Template - Email Marketing Automation{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">
                    <i data-feather="file-text"></i>
                    Create Email Template
                </h3>
            </div>
            
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="card-body">
                    {% if branded_template %}
                    <div class="alert alert-info">
                        <i data-feather="layout"></i>
                        <strong>Using Branded Template:</strong> {{ branded_template.name }}<br>
                        <small>{{ branded_template.description }}</small>
                    </div>
                    {% endif %}
                    
                    <div class="mb-4">
                        <label for="name" class="form-label">Template Name *</label>
                        <input type="text" class="form-control" id="name" name="name" 
                               value="{% if branded_template %}{{ branded_template.name }}{% endif %}" required>
                        <div class="form-text">A descriptive name for your template</div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="subject" class="form-label">Default Subject *</label>
                        <input type="text" class="form-control" id="subject" name="subject" 
                               value="{{ default_subject or '' }}" required>
                        <div class="form-text">Default subject line (can be overridden in campaigns)</div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="html_content" class="form-label">HTML Content *</label>
                        <textarea class="form-control" id="html_content" name="html_content" rows="20" required>{{ default_html or '' }}</textarea>
                        <div class="form-text">
                            HTML content for your email template. You can use template variables like {{ "{{contact.first_name}}" }}, {{ "{{contact.full_name}}" }}, {{ "{{contact.email}}" }}, {{ "{{contact.company}}" }}
                        </div>
                    </div>
                </div>
                
                <div class="card-footer">
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('main.templates') }}" class="btn btn-secondary">
                            <i data-feather="arrow-left"></i> Cancel
                        </a>
                        <div>
                            <a href="{{ url_for('main.template_gallery') }}" class="btn btn-outline-secondary me-2">
                                <i data-feather="layout"></i> Browse Templates
                            </a>
                            <button type="button" class="btn btn-outline-info me-2" onclick="previewTemplate()">
                                <i data-feather="eye"></i> Preview
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i data-feather="save"></i> Save Template
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Template Variables</h5>
            </div>
            <div class="card-body">
                <p>You can use these variables in your template:</p>
                
                <h6>Contact Variables:</h6>
                <ul class="list-unstyled">
                    <li><code>{{ "{" }}{{ "{" }}contact.first_name{{ "}" }}{{ "}" }}</code></li>
                    <li><code>{{ "{" }}{{ "{" }}contact.last_name{{ "}" }}{{ "}" }}</code></li>
                    <li><code>{{ "{" }}{{ "{" }}contact.full_name{{ "}" }}{{ "}" }}</code></li>
                    <li><code>{{ "{" }}{{ "{" }}contact.email{{ "}" }}{{ "}" }}</code></li>
                    <li><code>{{ "{" }}{{ "{" }}contact.company{{ "}" }}{{ "}" }}</code></li>
                    <li><code>{{ "{" }}{{ "{" }}contact.phone{{ "}" }}{{ "}" }}</code></li>
                </ul>
                
                <h6>Campaign Variables:</h6>
                <ul class="list-unstyled">
                    <li><code>{{ "{" }}{{ "{" }}campaign.name{{ "}" }}{{ "}" }}</code></li>
                    <li><code>{{ "{" }}{{ "{" }}campaign.subject{{ "}" }}{{ "}" }}</code></li>
                </ul>
                
                <h6>System Variables:</h6>
                <ul class="list-unstyled">
                    <li><code>{{ "{" }}{{ "{" }}unsubscribe_url{{ "}" }}{{ "}" }}</code></li>
                    <li><code>{{ "{" }}{{ "{" }}tracking_pixel{{ "}" }}{{ "}" }}</code></li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Quick Templates</h5>
            </div>
            <div class="card-body">
                <button type="button" class="btn btn-outline-secondary btn-sm mb-2 w-100" onclick="loadTemplate('newsletter')">
                    Newsletter Template
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm mb-2 w-100" onclick="loadTemplate('promotional')">
                    Promotional Template
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm mb-2 w-100" onclick="loadTemplate('default')">
                    Basic Template
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Template Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <iframe id="preview-frame" style="width: 100%; height: 500px; border: none;"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function previewTemplate() {
    const htmlContent = document.getElementById('html_content').value;
    const previewFrame = document.getElementById('preview-frame');
    
    // Replace template variables with sample data for preview
    const sampleData = htmlContent
        .replace(/\{\{contact\.first_name\}\}/g, 'John')
        .replace(/\{\{contact\.last_name\}\}/g, 'Doe')
        .replace(/\{\{contact\.full_name\}\}/g, 'John Doe')
        .replace(/\{\{contact\.email\}\}/g, 'john.doe@example.com')
        .replace(/\{\{contact\.company\}\}/g, 'Example Corp')
        .replace(/\{\{contact\.phone\}\}/g, '+1-555-0123')
        .replace(/\{\{campaign\.name\}\}/g, 'Sample Campaign')
        .replace(/\{\{campaign\.subject\}\}/g, 'Sample Subject')
        .replace(/\{\{unsubscribe_url\}\}/g, '#unsubscribe')
        .replace(/\{\{tracking_pixel\}\}/g, '');
    
    previewFrame.srcdoc = sampleData;
    
    const modal = new bootstrap.Modal(document.getElementById('previewModal'));
    modal.show();
}

function loadTemplate(type) {
    const templates = {
        'default': `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>\${campaign.subject}</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #007bff; color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; background: #f8f9fa; }
        .footer { padding: 20px; text-align: center; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Your Company Name</h1>
        </div>
        <div class="content">
            <p>Hello \${contact.first_name},</p>
            <p>Welcome to our newsletter! We're excited to share updates with you.</p>
            <p>Best regards,<br>Your Team</p>
        </div>
        <div class="footer">
            <p><a href="\${unsubscribe_url}">Unsubscribe</a> | Your Company Address</p>
            <img src="\${tracking_pixel}" width="1" height="1" alt="">
        </div>
    </div>
</body>
</html>`,
        
        'newsletter': `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>\${campaign.subject}</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 0 auto; background: white; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 20px; text-align: center; }
        .content { padding: 30px 20px; }
        .article { margin-bottom: 30px; padding-bottom: 30px; border-bottom: 1px solid #eee; }
        .article:last-child { border-bottom: none; }
        .cta { background: #28a745; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 20px 0; }
        .footer { background: #f8f9fa; padding: 20px; text-align: center; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📧 Newsletter</h1>
            <p>Your weekly dose of updates</p>
        </div>
        <div class="content">
            <p>Hi \${contact.first_name},</p>
            
            <div class="article">
                <h2>📈 This Week's Highlights</h2>
                <p>Here are the most important updates from our team this week...</p>
            </div>
            
            <div class="article">
                <h2>🚀 Product Updates</h2>
                <p>We've been working hard to improve your experience...</p>
                <a href="#" class="cta">Learn More</a>
            </div>
            
            <p>Thanks for being part of our community!</p>
            <p>Best regards,<br>The \${contact.company} Team</p>
        </div>
        <div class="footer">
            <p>You're receiving this because you subscribed to our newsletter.</p>
            <p><a href="\${unsubscribe_url}">Unsubscribe</a> | Contact us at hello@company.com</p>
            <img src="\${tracking_pixel}" width="1" height="1" alt="">
        </div>
    </div>
</body>
</html>`,
        
        'promotional': `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>\${campaign.subject}</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f4f4f4; }
        .container { max-width: 600px; margin: 0 auto; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .header { background: #dc3545; color: white; padding: 20px; text-align: center; }
        .content { padding: 40px 20px; text-align: center; }
        .offer { background: #fff3cd; border: 2px dashed #ffc107; padding: 30px; margin: 30px 0; border-radius: 10px; }
        .cta { background: #dc3545; color: white; padding: 20px 40px; font-size: 18px; text-decoration: none; border-radius: 50px; display: inline-block; margin: 20px 0; font-weight: bold; }
        .footer { background: #6c757d; color: white; padding: 20px; text-align: center; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔥 SPECIAL OFFER</h1>
            <p>Limited Time Only!</p>
        </div>
        <div class="content">
            <h2>Hello \${contact.first_name}!</h2>
            
            <div class="offer">
                <h1 style="margin: 0; color: #dc3545;">50% OFF</h1>
                <p style="font-size: 18px; margin: 10px 0;">Everything Must Go!</p>
                <p><strong>Use code: SAVE50</strong></p>
            </div>
            
            <p>Don't miss out on this incredible opportunity to save big on all our products!</p>
            
            <a href="#" class="cta">SHOP NOW</a>
            
            <p style="color: #dc3545; font-weight: bold;">⏰ Offer expires in 48 hours!</p>
        </div>
        <div class="footer">
            <p>This offer is exclusive to our valued customers like you.</p>
            <p><a href="\${unsubscribe_url}" style="color: white;">Unsubscribe</a> | Your Company Name</p>
            <img src="\${tracking_pixel}" width="1" height="1" alt="">
        </div>
    </div>
</body>
</html>`
    };
    
    if (templates[type]) {
        document.getElementById('html_content').value = templates[type];
    }
}
</script>
{% endblock %}
